name: Build Windows EXE

on:
  push:
    branches: [ main ]
    tags:
      - 'v*'
  workflow_dispatch:  # Manuel tetikleme

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
        
    - name: Build EXE with PyInstaller
      run: |
        pyinstaller --onefile --windowed --name="MDB-Analiz-v1.0" --icon=NONE mdb_gui.py
        
    - name: Upload EXE as artifact
      uses: actions/upload-artifact@v3
      with:
        name: MDB-Analiz-Windows
        path: dist/*.exe
        
    - name: Create Release (on tag)
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: dist/*.exe
        body: |
          ## ğŸ‰ MDB Analiz ProgramÄ± - Windows EXE
          
          ### ğŸ“¥ Ä°ndirme:
          AÅŸaÄŸÄ±daki .exe dosyasÄ±nÄ± indirin ve Ã§ift tÄ±klayÄ±n!
          
          ### âœ… Gereksinimler:
          - Windows 10/11
          - Microsoft Access Database Engine (ilk Ã§alÄ±ÅŸtÄ±rmada program sÃ¶yleyecek)
          
          ### ğŸš€ KullanÄ±m:
          1. .exe dosyasÄ±nÄ± indirin
          2. Ã‡ift tÄ±klayÄ±n
          3. "Dosya SeÃ§" ile .mdb dosyanÄ±zÄ± seÃ§in
          4. "Analiz Et" butonuna basÄ±n!
          
          ### ğŸ› Sorun mu yaÅŸÄ±yorsunuz?
          - Windows Defender uyarÄ±sÄ±: "More info" â†’ "Run anyway"
          - Issues bÃ¶lÃ¼mÃ¼nden bildirin!
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
